<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="pragma" content="no-cache" />
        <meta http-equiv="content-language" content="pt-br, en-US" />
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

        <title>Cliente</title>

        <script src="/socket.io/socket.io.js"></script>
    </head>
    <body>
        <app></app>
    </body>

    <script>
        const socket = io();
        const app = document.querySelector("app");

        // Static Functions
        window.Component = (component, extra_selectors) => {
            if (!component) return;
            if (!extra_selectors) extra_selectors = "";

            return document.querySelector(
                `[c=${component}] ${extra_selectors}`
            );
        };

        window.ListenEvent = (event_name, callback) => {
            socket.on(event_name, callback);
            socket._callbacks["$" + event_name] = [callback];
        };

        window.EmitEvent = (event_name, data) => {
            socket.emit(event_name, data);
        };

        // Static Events
        ListenEvent("Event::RenderPage", (payload) => {
            data = { ...data, ...payload };

            const html = document
                .createRange()
                .createContextualFragment(payload.content);
            app.replaceChildren(html);
        });

        // Init App
        let data = {};

        setInterval(() => {
            localStorage.setItem("data", JSON.stringify(data));
        }, 100);

        // Try to load a ID and Token from LocalStorage
        const loaded = localStorage.getItem("data");
        if (loaded) {
            data = JSON.parse(loaded);
        }

        if (!data.id || !data.token)
            EmitEvent("Event::RenderPage", {
                page: "Login",
            });
        else
            EmitEvent("Event::RenderPage", {
                page: "Home",
            });
    </script>
</html>
